(function(x,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(x=typeof globalThis<"u"?globalThis:x||self,e(x.foxPreviewImage={},x.Vue))})(this,function(x,e){"use strict";function k(t){return Object.prototype.toString.call(t).replace(new RegExp("(^[[a-z]+ )([A-Za-z]+)(])","g"),"$2").toLowerCase()}const b=Object.create(null);function j(t){return k(t)==="object"}function O(t){return k(t)==="function"}function D(t){return k(t)==="array"}function A(t){return k(t)==="symbol"}function P(t){return[0,void 0,null].includes(t)}b.isObject=j,b.isFunction=O,b.isArray=D,b.isSymbol=A,b.isFalse=P,k.prototype=b;const y=(t,n)=>{const o=t.__vccOpts||t;for(const[r,s]of n)o[r]=s;return o},W={},H={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"},K=[e.createElementVNode("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null,-1)];function X(t,n){return e.openBlock(),e.createElementBlock("svg",H,K)}const Y=y(W,[["render",X]]),Z={},q={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"},G=[e.createElementVNode("path",{fill:"currentColor",d:"M340.864 149.312a30.592 30.592 0 0 0 0 42.752L652.736 512 340.864 831.872a30.592 30.592 0 0 0 0 42.752 29.12 29.12 0 0 0 41.728 0L714.24 534.336a32 32 0 0 0 0-44.672L382.592 149.376a29.12 29.12 0 0 0-41.728 0z"},null,-1)];function U(t,n){return e.openBlock(),e.createElementBlock("svg",q,G)}const M=y(Z,[["render",U]]),J={class:"fox-preview-switch"},Q=e.defineComponent({__name:"switch",emits:["prev","next"],setup(t,{emit:n}){const o=n,r=()=>{o("prev")},s=()=>{o("next")};return(d,c)=>(e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("div",{class:"fox-preview-switch-item fox-preview-switch-item-left",onClick:r},[e.createVNode(M,{class:"preview-operate-icon preview-switch-icon-left"})]),e.createElementVNode("div",{class:"fox-preview-switch-item",onClick:s},[e.createVNode(M,{class:"fox-preview-switch-icon fox-preview-switch-icon"})])]))}}),ee={},te={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"},oe=[e.createElementVNode("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704zM352 448h256a32 32 0 0 1 0 64H352a32 32 0 0 1 0-64z"},null,-1)];function ne(t,n){return e.openBlock(),e.createElementBlock("svg",te,oe)}const le=y(ee,[["render",ne]]),se={},re={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"},ce=[e.createElementVNode("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704zm-32-384v-96a32 32 0 0 1 64 0v96h96a32 32 0 0 1 0 64h-96v96a32 32 0 0 1-64 0v-96h-96a32 32 0 0 1 0-64h96z"},null,-1)];function ae(t,n){return e.openBlock(),e.createElementBlock("svg",re,ce)}const ie=y(se,[["render",ae]]),de={},fe={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"},me=[e.createElementVNode("path",{fill:"currentColor",d:"M289.088 296.704h92.992a32 32 0 0 1 0 64H232.96a32 32 0 0 1-32-32V179.712a32 32 0 0 1 64 0v50.56a384 384 0 0 1 643.84 282.88 384 384 0 0 1-383.936 384 384 384 0 0 1-384-384h64a320 320 0 1 0 640 0 320 320 0 0 0-555.712-216.448z"},null,-1)];function ue(t,n){return e.openBlock(),e.createElementBlock("svg",fe,me)}const pe=y(de,[["render",ue]]),he={},_e={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"},we=[e.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"},null,-1)];function xe(t,n){return e.openBlock(),e.createElementBlock("svg",_e,we)}const ye=y(he,[["render",xe]]),ge={},ke={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"},be=[e.createElementVNode("path",{fill:"currentColor",d:"M160 832h704a32 32 0 1 1 0 64H160a32 32 0 1 1 0-64zm384-253.696 236.288-236.352 45.248 45.248L508.8 704 192 387.2l45.248-45.248L480 584.704V128h64v450.304z"},null,-1)];function $e(t,n){return e.openBlock(),e.createElementBlock("svg",ke,be)}const Be=y(ge,[["render",$e]]),ve={class:"fox-preview-toolbar"},Ce={role:"button",title:"缩放倍数",tabindex:"-1",class:"fox-preview-toolbar-item fox-preview-toolbar-scale"},Ve={role:"button",title:"图片位置",class:"fox-preview-toolbar-item fox-preview-toolbar-position"},Ee=e.defineComponent({__name:"toolbar",props:{scale:{default:1},index:{default:"1/1"}},emits:["click"],setup(t,{emit:n}){const o=t,r=n,s=d=>{r("click",d)};return(d,c)=>(e.openBlock(),e.createElementBlock("div",ve,[e.createVNode(le,{role:"button",title:"缩小",class:"fox-preview-toolbar-item",onClick:c[0]||(c[0]=m=>s("zoom-out"))}),e.createVNode(ie,{role:"button",title:"放大",class:"fox-preview-toolbar-item",onClick:c[1]||(c[1]=m=>s("zoom-in"))}),e.createElementVNode("div",Ce,e.toDisplayString(o.scale),1),e.createElementVNode("div",Ve,e.toDisplayString(o.index),1),e.createVNode(pe,{role:"button",title:"左旋转",class:"fox-preview-toolbar-item",onClick:c[2]||(c[2]=m=>s("contraRotate"))}),e.createVNode(ye,{role:"button",title:"右旋转",class:"fox-preview-toolbar-item",onClick:c[3]||(c[3]=m=>s("clockwiseRotation"))}),e.createVNode(Be,{role:"button",title:"下载/保存",class:"fox-preview-toolbar-item",onClick:c[4]||(c[4]=m=>s("download"))})]))}});function Ne(t){return typeof t=="function"?t():e.unref(t)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const T=()=>{};function ze(t,n){function o(...r){return new Promise((s,d)=>{Promise.resolve(t(()=>n.apply(this,r),{fn:n,thisArg:this,args:r})).then(s).catch(d)})}return o}function Me(...t){let n=0,o,r=!0,s=T,d,c,m,a,_;!e.isRef(t[0])&&typeof t[0]=="object"?{delay:c,trailing:m=!0,leading:a=!0,rejectOnCancel:_=!1}=t[0]:[c,m=!0,a=!0,_=!1]=t;const u=()=>{o&&(clearTimeout(o),o=void 0,s(),s=T)};return $=>{const p=Ne(c),g=Date.now()-n,f=()=>d=$();return u(),p<=0?(n=Date.now(),f()):(g>p&&(a||!r)?(n=Date.now(),f()):m&&(d=new Promise((w,z)=>{s=_?z:w,o=setTimeout(()=>{n=Date.now(),r=!0,w(f()),u()},Math.max(0,p-g))})),!a&&!o&&(o=setTimeout(()=>r=!0,p)),r=!1,d)}}function L(t,n=200,o=!1,r=!0,s=!1){return ze(Me(n,o,r,s),t)}const Te=(t,n)=>{const o=document.createElement("a");o.download=n,o.href=t,o.style.display="none",document.body.appendChild(o),o.click();const r=setTimeout(()=>{document.body.removeChild(o),clearTimeout(r)},10)},Le=()=>{const t=document.createElement("div"),n=document.createElement("div");t.appendChild(n),t.style.width="100px",t.style.height="50px",t.style.overflow="scroll",t.style.marginLeft="-100000px",document.body.appendChild(t);const o=n.offsetWidth,r=t.offsetWidth,s=setTimeout(()=>{document.body.removeChild(t),clearTimeout(s)},10);return r-o},Se=["onKeyup"],Fe=["src"],C=e.defineComponent({name:"FoxPreviewImage",__name:"index",props:{modelValue:{type:Boolean,default:!1},src:{default:""},zIndex:{default:9e3},initialIndex:{default:0},appendTo:{default:"body"},showToolbar:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(t,{emit:n}){const o=t,r=n;let s="";e.onBeforeMount(()=>{s=document.body.style.cssText});const d=e.ref(null);let c=e.ref(!1),m=e.ref(0),a=o.src&&o.src.length?e.ref(o.initialIndex):e.ref(0),_=e.ref(0),u=e.ref(1),B=e.ref(0),$=e.ref(0),p=e.ref(0),g=e.ref(0),f=e.ref([]),w=e.reactive({x:0,y:0});const z=()=>{c.value=o.modelValue},S=()=>{c.value=!1,r("update:modelValue",c.value)},Ie=l=>{if(m.value!==1)return;const{x:i,y:h}=l,v=i-w.x,N=h-w.y;p.value=v+p.value-B.value,g.value=N+g.value-$.value,B.value=v,$.value=N},F=()=>{u.value>.5&&(u.value-=.1)},I=()=>{u.value<2&&(u.value+=.1)},Re=l=>{requestAnimationFrame(()=>{(l.wheelDelta||l.detail*-40)>0?I():F()})},R=L(Ie,10),V=L(Re,10),je=()=>{m.value=0,B.value=0,$.value=0},Oe=l=>{m.value=1,w={x:l.x,y:l.y}},De=()=>{_.value+=90},Ae=()=>{_.value-=90},Pe=()=>{const l=f.value[a.value],i=l.split("/"),h=i[i.length-1];Te(l,h)},E=()=>{_.value=0,u.value=1,p.value=0,g.value=0,w.x=0,w.y=0,B.value=0,$.value=0},We=()=>{const l=f.value.length||0;a.value>0?a.value--:a.value=l-1,E()},He=()=>{const l=f.value.length||0;a.value<l-1?a.value++:a.value=0,E()},Ke=e.computed(()=>parseFloat(u.value.toFixed(1))),Xe=e.computed(()=>`${a.value+1}/${f.value.length}`),Ye=l=>{switch(l){case"zoom-out":F();break;case"zoom-in":I();break;case"contraRotate":Ae();break;case"clockwiseRotation":De();break;case"download":Pe();break}};e.onMounted(()=>{z()});const Ze=l=>l.scrollHeight>window.innerHeight;return e.watch(()=>o.modelValue,l=>{c.value=l,l?(d.value!==null&&d.value.focus(),Ze(document.body)&&(document.body.style.paddingRight=Le()+"px",document.body.classList.add("fox-lock-window"))):(document.body.classList.remove("fox-lock-window"),s?document.body.style.cssText=s:document.body.removeAttribute("style"))}),e.watch(()=>o.src,l=>{const i=k(l);i==="string"?(a.value=0,E(),f.value=[l]):i==="array"&&(o.initialIndex>=0&&o.initialIndex<l.length?a.value=o.initialIndex:a.value=0,E(),f.value=l)},{immediate:!0}),(l,i)=>(e.openBlock(),e.createBlock(e.Teleport,{to:o.appendTo},[e.createVNode(e.Transition,null,{default:e.withCtx(()=>[e.unref(c)?(e.openBlock(),e.createElementBlock("div",{key:0,role:"dialog",ref_key:"refEl",ref:d,class:"fox-preview",style:e.normalizeStyle({"z-index":o.zIndex}),tabindex:"1",onKeyup:e.withKeys(e.withModifiers(S,["exact"]),["esc"])},[e.createElementVNode("div",{class:"fox-preview-canvas",onMousewheel:i[1]||(i[1]=(...h)=>e.unref(V)&&e.unref(V)(...h)),"on:DOMMouseScroll":i[2]||(i[2]=(...h)=>e.unref(V)&&e.unref(V)(...h))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(f),(h,v)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:v},[e.unref(a)===v?(e.openBlock(),e.createElementBlock("div",{key:0,onMousemove:i[0]||(i[0]=(...N)=>e.unref(R)&&e.unref(R)(...N)),onMouseup:je,onMousedown:Oe,style:e.normalizeStyle([{transform:`rotate(${e.unref(_)}deg) scale(${e.unref(u)}) translate(${e.unref(p)}px,${e.unref(g)}px)`},{display:"inline-block"}])},[e.createElementVNode("img",{class:"fox-preview-image",src:h,alt:"被拖拽的图片",draggable:"false"},null,8,Fe)],36)):e.createCommentVNode("",!0)],64))),128))],32),e.createElementVNode("div",{class:"fox-preview-close",onClick:S},[e.createVNode(Y)]),e.unref(f)&&e.unref(f).length>1?(e.openBlock(),e.createBlock(Q,{key:0,onPrev:We,onNext:He})):e.createCommentVNode("",!0),l.showToolbar?(e.openBlock(),e.createBlock(Ee,{key:1,onClick:Ye,scale:Ke.value,index:Xe.value},null,8,["scale","index"])):e.createCommentVNode("",!0)],44,Se)):e.createCommentVNode("",!0)]),_:1})],8,["to"]))}});C.install=t=>{t.component(C.name,C)},x.default=C,Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
