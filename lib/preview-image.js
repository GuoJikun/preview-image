(function(y,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(y=typeof globalThis<"u"?globalThis:y||self,e(y.foxPreviewImage={},y.Vue))})(this,function(y,e){"use strict";function b(t){return Object.prototype.toString.call(t).replace(new RegExp("(^[[a-z]+ )([A-Za-z]+)(])","g"),"$2").toLowerCase()}const _=Object.create(null);function j(t){return b(t)==="object"}function O(t){return b(t)==="function"}function D(t){return b(t)==="array"}function A(t){return b(t)==="symbol"}function P(t){return[0,void 0,null].includes(t)}_.isObject=j,_.isFunction=O,_.isArray=D,_.isSymbol=A,_.isFalse=P,b.prototype=_;const g=(t,o)=>{const n=t.__vccOpts||t;for(const[s,r]of o)n[s]=r;return n},W={},H={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"};function K(t,o){return e.openBlock(),e.createElementBlock("svg",H,o[0]||(o[0]=[e.createElementVNode("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null,-1)]))}const X=g(W,[["render",K]]),Y={},Z={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"};function q(t,o){return e.openBlock(),e.createElementBlock("svg",Z,o[0]||(o[0]=[e.createElementVNode("path",{fill:"currentColor",d:"M340.864 149.312a30.592 30.592 0 0 0 0 42.752L652.736 512 340.864 831.872a30.592 30.592 0 0 0 0 42.752 29.12 29.12 0 0 0 41.728 0L714.24 534.336a32 32 0 0 0 0-44.672L382.592 149.376a29.12 29.12 0 0 0-41.728 0z"},null,-1)]))}const M=g(Y,[["render",q]]),G={class:"fox-preview-switch"},U=e.defineComponent({__name:"switch",emits:["prev","next"],setup(t,{emit:o}){const n=o,s=()=>{n("prev")},r=()=>{n("next")};return(d,a)=>(e.openBlock(),e.createElementBlock("div",G,[e.createElementVNode("div",{class:"fox-preview-switch-item fox-preview-switch-item-left",onClick:s},[e.createVNode(M,{class:"preview-operate-icon preview-switch-icon-left"})]),e.createElementVNode("div",{class:"fox-preview-switch-item",onClick:r},[e.createVNode(M,{class:"fox-preview-switch-icon fox-preview-switch-icon"})])]))}}),J={},Q={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"};function ee(t,o){return e.openBlock(),e.createElementBlock("svg",Q,o[0]||(o[0]=[e.createElementVNode("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704zM352 448h256a32 32 0 0 1 0 64H352a32 32 0 0 1 0-64z"},null,-1)]))}const te=g(J,[["render",ee]]),oe={},ne={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"};function le(t,o){return e.openBlock(),e.createElementBlock("svg",ne,o[0]||(o[0]=[e.createElementVNode("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704zm-32-384v-96a32 32 0 0 1 64 0v96h96a32 32 0 0 1 0 64h-96v96a32 32 0 0 1-64 0v-96h-96a32 32 0 0 1 0-64h96z"},null,-1)]))}const re=g(oe,[["render",le]]),se={},ae={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"};function ce(t,o){return e.openBlock(),e.createElementBlock("svg",ae,o[0]||(o[0]=[e.createElementVNode("path",{fill:"currentColor",d:"M289.088 296.704h92.992a32 32 0 0 1 0 64H232.96a32 32 0 0 1-32-32V179.712a32 32 0 0 1 64 0v50.56a384 384 0 0 1 643.84 282.88 384 384 0 0 1-383.936 384 384 384 0 0 1-384-384h64a320 320 0 1 0 640 0 320 320 0 0 0-555.712-216.448z"},null,-1)]))}const ie=g(se,[["render",ce]]),de={},fe={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"};function ue(t,o){return e.openBlock(),e.createElementBlock("svg",fe,o[0]||(o[0]=[e.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"},null,-1)]))}const me=g(de,[["render",ue]]),pe={},we={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",class:"svg","aria-role":"button"};function xe(t,o){return e.openBlock(),e.createElementBlock("svg",we,o[0]||(o[0]=[e.createElementVNode("path",{fill:"currentColor",d:"M160 832h704a32 32 0 1 1 0 64H160a32 32 0 1 1 0-64zm384-253.696 236.288-236.352 45.248 45.248L508.8 704 192 387.2l45.248-45.248L480 584.704V128h64v450.304z"},null,-1)]))}const he=g(pe,[["render",xe]]),ye={class:"fox-preview-toolbar"},ge={role:"button",title:"缩放倍数",tabindex:"-1",class:"fox-preview-toolbar-item fox-preview-toolbar-scale"},ke={role:"button",title:"图片位置",class:"fox-preview-toolbar-item fox-preview-toolbar-position"},be=e.defineComponent({__name:"toolbar",props:{scale:{default:1},index:{default:"1/1"}},emits:["click"],setup(t,{emit:o}){const n=t,s=o,r=d=>{s("click",d)};return(d,a)=>(e.openBlock(),e.createElementBlock("div",ye,[e.createVNode(te,{role:"button",title:"缩小",class:"fox-preview-toolbar-item",onClick:a[0]||(a[0]=u=>r("zoom-out"))}),e.createVNode(re,{role:"button",title:"放大",class:"fox-preview-toolbar-item",onClick:a[1]||(a[1]=u=>r("zoom-in"))}),e.createElementVNode("div",ge,e.toDisplayString(n.scale),1),e.createElementVNode("div",ke,e.toDisplayString(n.index),1),e.createVNode(ie,{role:"button",title:"左旋转",class:"fox-preview-toolbar-item",onClick:a[2]||(a[2]=u=>r("contraRotate"))}),e.createVNode(me,{role:"button",title:"右旋转",class:"fox-preview-toolbar-item",onClick:a[3]||(a[3]=u=>r("clockwiseRotation"))}),e.createVNode(he,{role:"button",title:"下载/保存",class:"fox-preview-toolbar-item",onClick:a[4]||(a[4]=u=>r("download"))})]))}});typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const T=()=>{};function _e(t,o){function n(...s){return new Promise((r,d)=>{Promise.resolve(t(()=>o.apply(this,s),{fn:o,thisArg:this,args:s})).then(r).catch(d)})}return n}function ve(...t){let o=0,n,s=!0,r=T,d,a,u,c,x;!e.isRef(t[0])&&typeof t[0]=="object"?{delay:a,trailing:u=!0,leading:c=!0,rejectOnCancel:x=!1}=t[0]:[a,u=!0,c=!0,x=!1]=t;const m=()=>{n&&(clearTimeout(n),n=void 0,r(),r=T)};return v=>{const p=e.toValue(a),k=Date.now()-o,f=()=>d=v();return m(),p<=0?(o=Date.now(),f()):(k>p&&(c||!s)?(o=Date.now(),f()):u&&(d=new Promise((h,z)=>{r=x?z:h,n=setTimeout(()=>{o=Date.now(),s=!0,h(f()),m()},Math.max(0,p-k))})),!c&&!n&&(n=setTimeout(()=>s=!0,p)),s=!1,d)}}function L(t,o=200,n=!1,s=!0,r=!1){return _e(ve(o,n,s,r),t)}const Be=(t,o)=>{const n=document.createElement("a");n.download=o,n.href=t,n.style.display="none",document.body.appendChild(n),n.click();const s=setTimeout(()=>{document.body.removeChild(n),clearTimeout(s)},10)},Ce=()=>{const t=document.createElement("div"),o=document.createElement("div");t.appendChild(o),t.style.width="100px",t.style.height="50px",t.style.overflow="scroll",t.style.marginLeft="-100000px",document.body.appendChild(t);const n=o.offsetWidth,s=t.offsetWidth,r=setTimeout(()=>{document.body.removeChild(t),clearTimeout(r)},10);return s-n},$e=["onKeyup"],Ve=["src"],$=e.defineComponent({name:"FoxPreviewImage",__name:"index",props:{modelValue:{type:Boolean,default:!1},src:{default:""},zIndex:{default:9e3},initialIndex:{default:0},appendTo:{default:"body"},showToolbar:{type:Boolean,default:!0},enableTeleport:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:o}){const n=t,s=o;let r="";e.onBeforeMount(()=>{r=document.body.style.cssText});const d=e.ref(null),a=e.ref(!1),u=e.ref(0),c=n.src&&n.src.length?e.ref(n.initialIndex):e.ref(0),x=e.ref(0),m=e.ref(1),B=e.ref(0),v=e.ref(0),p=e.ref(0),k=e.ref(0),f=e.ref([]);let h=e.reactive({x:0,y:0});const z=()=>{a.value=n.modelValue},S=()=>{a.value=!1,s("update:modelValue",a.value)},Ee=l=>{if(u.value!==1)return;const{x:i,y:w}=l,C=i-h.x,N=w-h.y;p.value=C+p.value-B.value,k.value=N+k.value-v.value,B.value=C,v.value=N},F=()=>{m.value>.5&&(m.value-=.1)},I=()=>{m.value<2&&(m.value+=.1)},Ne=l=>{requestAnimationFrame(()=>{(l.wheelDelta||l.detail*-40)>0?I():F()})},R=L(Ee,10),V=L(Ne,10),ze=()=>{u.value=0,B.value=0,v.value=0},Me=l=>{u.value=1,h={x:l.x,y:l.y}},Te=()=>{x.value+=90},Le=()=>{x.value-=90},Se=()=>{const l=f.value[c.value],i=l.split("/"),w=i[i.length-1];Be(l,w)},E=()=>{x.value=0,m.value=1,p.value=0,k.value=0,h.x=0,h.y=0,B.value=0,v.value=0},Fe=()=>{const l=f.value.length||0;c.value>0?c.value--:c.value=l-1,E()},Ie=()=>{const l=f.value.length||0;c.value<l-1?c.value++:c.value=0,E()},Re=e.computed(()=>parseFloat(m.value.toFixed(1))),je=e.computed(()=>`${c.value+1}/${f.value.length}`),Oe=l=>{switch(l){case"zoom-out":F();break;case"zoom-in":I();break;case"contraRotate":Le();break;case"clockwiseRotation":Te();break;case"download":Se();break}};e.onMounted(()=>{z()});const De=l=>l.scrollHeight>window.innerHeight;return e.watch(()=>n.modelValue,l=>{a.value=l,l?(d.value!==null&&d.value.focus(),De(document.body)&&(document.body.style.paddingRight=Ce()+"px",document.body.classList.add("fox-lock-window"))):(document.body.classList.remove("fox-lock-window"),r?document.body.style.cssText=r:document.body.removeAttribute("style"))}),e.watch(()=>n.src,l=>{const i=b(l);i==="string"?(c.value=0,E(),f.value=[l]):i==="array"&&(n.initialIndex>=0&&n.initialIndex<l.length?c.value=n.initialIndex:c.value=0,E(),f.value=l)},{immediate:!0}),(l,i)=>(e.openBlock(),e.createBlock(e.Teleport,{to:n.appendTo,disabled:n.enableTeleport===!1},[e.createVNode(e.Transition,null,{default:e.withCtx(()=>[a.value?(e.openBlock(),e.createElementBlock("div",{key:0,role:"dialog",ref_key:"refEl",ref:d,class:"fox-preview",style:e.normalizeStyle({"z-index":n.zIndex}),tabindex:"1",onKeyup:e.withKeys(e.withModifiers(S,["exact"]),["esc"])},[e.createElementVNode("div",{class:"fox-preview-canvas",onMousewheel:i[1]||(i[1]=(...w)=>e.unref(V)&&e.unref(V)(...w)),"on:DOMMouseScroll":i[2]||(i[2]=(...w)=>e.unref(V)&&e.unref(V)(...w))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,(w,C)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:C},[e.unref(c)===C?(e.openBlock(),e.createElementBlock("div",{key:0,onMousemove:i[0]||(i[0]=(...N)=>e.unref(R)&&e.unref(R)(...N)),onMouseup:ze,onMousedown:Me,style:e.normalizeStyle([{transform:`rotate(${x.value}deg) scale(${m.value}) translate(${p.value}px,${k.value}px)`},{display:"inline-block"}])},[e.createElementVNode("img",{class:"fox-preview-image",src:w,alt:"被拖拽的图片",draggable:"false"},null,8,Ve)],36)):e.createCommentVNode("",!0)],64))),128))],32),e.createElementVNode("div",{class:"fox-preview-close",onClick:S},[e.createVNode(X)]),f.value&&f.value.length>1?(e.openBlock(),e.createBlock(U,{key:0,onPrev:Fe,onNext:Ie})):e.createCommentVNode("",!0),l.showToolbar?(e.openBlock(),e.createBlock(be,{key:1,onClick:Oe,scale:Re.value,index:je.value},null,8,["scale","index"])):e.createCommentVNode("",!0)],44,$e)):e.createCommentVNode("",!0)]),_:1})],8,["to","disabled"]))}});$.install=t=>{t.component($.name,$)},y.default=$,Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
